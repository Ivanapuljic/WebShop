define("saveditemssdk/global",[],function(){return window}),define("saveditemssdk/utils/getInstanceEventBus",["jquery"],function(e){return"function"==typeof e?e({}):void 0}),define("saveditemssdk/utils/sdkInstanceAsyncLoader",["saveditemssdk/utils/getInstanceEventBus"],function(e){var t={};return t.load=function(t,s,n,r){return r.isBuild?void n(t):(e.savedItemsSdkInstantiated&&n(t),void e.on("savedItemsSdk:instanceReady",function(){n(t)}))},t}),define("Asos.Customer.SavedItems.Sdk",["saveditemssdk/global","saveditemssdk/utils/sdkInstanceAsyncLoader!dummyModuleName"],function(e){var t=["asos","customer","_savedItemsSdkInstance"].reduce(function(e,t){return"undefined"!=typeof e?e[t]:void 0},e);return t}),define("saveditemssdk/config/configuration",[],function(){return{}}),define("saveditemssdk/config/defaultConfiguration",["saveditemssdk/global"],function(e){var t="https://"+e.location.hostname,s="https://"+e.location.hostname+"/api";return{savedItemsApiUrl:s,xSiteOrigin:null,postMessageUrl:t}}),define("saveditemssdk/exceptions/savedItemsSdkException",[],function(){function e(e){this.name="SavedItemsSdkException",this.message=e,this.stack=(new Error).stack}return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}),define("saveditemssdk/exceptions/argumentError",["./savedItemsSdkException"],function(e){function t(e){this.name="ArgumentError",this.message=e,this.stack=(new Error).stack}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}),define("saveditemssdk/exceptions/savedItemsSdkSingleInstanceMismatchError",["./savedItemsSdkException"],function(e){function t(){this.name="SavedItemsSdkSingleInstanceMismatchError",this.stack=(new Error).stack}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}),define("saveditemssdk/utils/comparer",[],function(){var e=function(e,t){var s=Object.keys(e),n=Object.keys(t);return s.length!==n.length?!1:s.every(function(s){return e[s]===t[s]})},t=function(t,s){return e(t,s)},s=function(t,s){return e(t,s)};return{areConfigurationsEqual:t,areContextsEqual:s}}),define("saveditemssdk/models/apiService",["jquery","uuid","saveditemssdk/config/configuration","saveditemssdk/global"],function(e,t,s,n){function r(t){if(this.defaultOptions={contentType:"application/json",dataType:"json",headers:{"asos-c-plat":"Web","asos-c-name":"Asos.Customer.SavedItems.Sdk","asos-c-ver":"3.1.0","asos-c-istablet":!1,"asos-c-ismobile":!1}},e.extend(!0,this.defaultOptions,t),!this.isCorsSupported()){var r=n.document.createElement("a");r.href=s.postMessageUrl,this.gatewayOrigin=r.protocol+"//"+r.hostname,d(r)||(this.gatewayOrigin+=":"+r.port),this.postMessageInitiator="SavedItemsSdk",o=e('iframe[src="'+s.postMessageUrl+'"]'),0===o.length&&(o=e("<iframe>").attr("src",s.postMessageUrl).appendTo(n.document.body).css("display","none")),i=o.get(0).contentWindow,n.addEventListener?n.addEventListener("message",this.postMessageTransportEventHandler.bind(this),!1):n.attachEvent&&n.attachEvent("onmessage",this.postMessageTransportEventHandler.bind(this))}}var o,i,a=0,d=function(e){return"https:"===e.protocol&&"443"===e.port||"http:"===e.protocol&&"80"===e.port},u=function(e){return null===e||void 0===e?"":e.join(":::")},c=function(e){return e=e||"",e.split(":::")};return r.prototype.isCorsSupported=function(){return"XMLHttpRequest"in n&&"withCredentials"in new XMLHttpRequest},r.prototype.setupRequestAjaxOptions=function(n,r,o){return n=e.extend(!0,{url:"",headers:{"asos-cid":t()}},this.defaultOptions,n||{}),s.hasOwnProperty("xSiteOrigin")&&s.xSiteOrigin&&r.withParam("x-site-origin",s.xSiteOrigin),n.type=r.method.toUpperCase(),n.url+=r.path,"object"==typeof o&&Object.keys(o).length&&(n.data=JSON.stringify(o)),n},r.prototype.successfulResponseHandler=function(e){return e},r.prototype.failedResponseHandler=function(e){var t="",s=e.getResponseHeader("content-type");return s&&-1!==s.indexOf("json")?JSON.parse(e.responseText):s&&-1!==s.indexOf("plain")&&e.responseText?e.responseText:t},r.prototype.jQueryTransport=function(t){return new Promise(function(s,n){e.ajax(t).done(function(){s(this.successfulResponseHandler.apply(this,arguments))}.bind(this)).fail(function(){n(this.failedResponseHandler.apply(this,arguments))}.bind(this))}.bind(this))},r.prototype.postMessageTransport=function(t){return new Promise(function(s,n){function r(t,r,o){e(this).off(u(["postMessageResolution",t])),o.success?s(o.data):n(o.data)}e(this).on(u(["postMessageResolution",a]),r.bind(this,a));var o=u([a,this.postMessageInitiator,JSON.stringify(t)]);this.postMessageSend(o),a++}.bind(this))},r.prototype.postMessageSend=function(t){i?i.postMessage(t,s.postMessageUrl):e(o).on("load",function(){i=o.get(0).contentWindow,i.postMessage(t,s.postMessageUrl)})},r.prototype.postMessageTransportEventHandler=function(t){if(t.origin===this.gatewayOrigin){var s,n=c(t.data),r=parseInt(n[0],10),o=parseInt(n[1],10),i=n[2];if(i!==this.postMessageInitiator)return;try{s=JSON.parse(n[3])}catch(a){s=""}e(this).trigger(u(["postMessageResolution",r]),{data:s,success:o})}},r.prototype.request=function(e,t,s){var r=this.setupRequestAjaxOptions(s,e,t),o=n.document.createElement("a");o.href=r.url;var i=o.hostname===n.location.hostname,a=o.protocol===n.location.protocol,d=r.url&&r.url.length&&"/"===r.url[0];return n.newrelic&&n.newrelic.interaction().save(),d||i&&a||this.isCorsSupported()?this.jQueryTransport(r):this.postMessageTransport(r)},r}),define("saveditemssdk/services/identityService",["require"],function(e){var t=function(){return new Promise(function(t){e(["Asos.Identity.Web.ClientSdk"],function(e){t(e)})})};return{customerGuid:function(){return t().then(function(e){return e.customer.customerGuid()})},getAccessToken:function(){return t().then(function(e){return e.getAccessToken()})}}}),define("saveditemssdk/services/savedItemsApiService",["saveditemssdk/models/apiService","saveditemssdk/services/identityService","saveditemssdk/exceptions/savedItemsSdkException"],function(e,t,s){function n(t){e.call(this,{url:t})}return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.prototype.exceptionHandler=function(e){throw Array.isArray(e)?new s(e):new Error(e)},n.prototype.request=function(s,n){return t.getAccessToken().then(function(t){var r={headers:{Authorization:"bearer "+t}};return e.prototype.request.call(this,s,n,r)}.bind(this))["catch"](this.exceptionHandler.bind(this))},n}),define("saveditemssdk/config/routes",[],function(){return{savedItems:{getDefaultSavedItems:{path:"/customer/savedlists/v2/customers/me/lists/default/items",method:"get"},addSavedItem:{path:"/customer/savedlists/v2/customers/me/lists/default/items",method:"post"},removeItem:{path:"/customer/savedlists/v2/customers/me/lists/default/items/:id",method:"delete"},updateItem:{path:"/customer/savedlists/v2/customers/me/lists/default/items/:id",method:"patch"}}}}),define("saveditemssdk/models/route",["saveditemssdk/global"],function(e){function t(e,t){this.path=e,this.method=t}return t.prototype.withExpansions=function(t){function s(t,s){if(t+=-1===t.indexOf("?")?"?":"&",t+="expand=",Array.isArray(s)){for(var n=0;n<s.length-1;n++)t+=e.escape(s[n])+",";t+=e.escape(s[s.length-1])}else t+=e.escape(s);return t}return this.path=s(this.path,t),this},t.prototype.withParam=function(t,s){function n(t,s,n){return t+=-1===t.indexOf("?")?"?":"&",t+=e.escape(s)+"="+e.escape(n)}return this.path=n(this.path,t,s),this},t}),define("saveditemssdk/services/routeService",["saveditemssdk/config/routes","saveditemssdk/models/route"],function(e,t){function s(t){var s=o;if(t&&t.routeCollection){if(!e[t.routeCollection])throw new Error('Unknown routeCollection "'+t.routeCollection+'".');s=e[t.routeCollection]}return s}function n(e,t){var s,n=e;for(var r in t)t.hasOwnProperty(r)&&(s=new RegExp(":"+r,"g"),n=n.replace(s,t[r]));return n}function r(e,r,o){var i=s(o),a=i[e];if(!a)throw new Error('Unknown route "'+e+'".');return new t(n(a.path,r),a.method)}var o=e.savedItems;return{createRoute:r}}),define("savedItemsSdk/sdk",["saveditemssdk/config/configuration","saveditemssdk/config/defaultConfiguration","saveditemssdk/exceptions/argumentError","saveditemssdk/exceptions/savedItemsSdkSingleInstanceMismatchError","saveditemssdk/utils/comparer","saveditemssdk/services/savedItemsApiService","saveditemssdk/services/routeService","saveditemssdk/global","jquery","saveditemssdk/utils/getInstanceEventBus"],function(e,t,s,n,r,o,i,a,d,u){function c(t){this._context=t,this._savedItemsApiService=new o(e.savedItemsApiUrl)}function p(e){return"RMB"===e?"CNY":e}c.prototype.getCustomerConfig=function(){return new Promise(function(e){e({country:this._context.originCountry,currency:this._context.currency})}.bind(this))},c.prototype.getSavedItems=function(e,t,s,n){var r=i.createRoute("getDefaultSavedItems").withParam("cb",this._getUniqueUrlValue());return this._addCommonRouteParams(r),e&&r.withParam("offset",e),t&&r.withParam("limit",t),s&&r.withParam("sort",s),n&&r.withParam("sortOrder",n),this._savedItemsApiService.request(r)},c.prototype.addProduct=function(e){if(e.hasOwnProperty("variantId"))return this.addVariant(e.productId,e.variantId,e.imageUrl);var t=i.createRoute("addSavedItem");return this._addCommonRouteParams(t),this._savedItemsApiService.request(t,{items:[{productId:e.productId,imageUrl:e.imageUrl||""}]})},c.prototype.addProducts=function(e){var t=i.createRoute("addSavedItem");return this._addCommonRouteParams(t),this._savedItemsApiService.request(t,{items:e.map(function(e){var t={productId:e.productId,imageUrl:e.imageUrl||""};return e.variantId&&(t.variantId=e.variantId),t})})},c.prototype.addVariant=function(e,t,s){var n=i.createRoute("addSavedItem");return this._addCommonRouteParams(n),this._savedItemsApiService.request(n,{items:[{variantId:t,productId:e,imageUrl:s||""}]})},c.prototype.addVariants=function(e){var t=i.createRoute("addSavedItem");return this._addCommonRouteParams(t),this._savedItemsApiService.request(t,{items:e.map(function(e){return{variantId:e.variantId,productId:e.productId,imageUrl:e.imageUrl||""}})})},c.prototype.removeItem=function(e){var t=i.createRoute("removeItem",{id:e}).withParam("store",this._context.storeId);return this._context.keyStoreDataversion&&t.withParam("keyStoreDataversion",this._context.keyStoreDataversion),this._savedItemsApiService.request(t)},c.prototype.updateItem=function(e,t){var s=i.createRoute("updateItem",{id:e});return this._addCommonRouteParams(s),this._savedItemsApiService.request(s,{variantId:t})},c.prototype._getUniqueUrlValue=function(){return(new Date).getTime()},c.prototype._addCommonRouteParams=function(e){e.withParam("store",this._context.storeId).withParam("currency",this._context.currency).withParam("sizeSchema",this._context.sizeSchema),this._context.keyStoreDataversion&&e.withParam("keyStoreDataversion",this._context.keyStoreDataversion)},a.asos=a.asos||{},a.asos.customer=a.asos.customer||{};var m=null,v=function(e){for(var t in e)null===e[t]&&delete e[t]},f=function(e){if(!e)throw new s("context is required");["storeId","originCountry","currency","language","sizeSchema"].forEach(function(t){if(!e[t])throw new s("context."+t+" is required")})};return a.asos.customer.savedItemsSdk={getInstance:function(s,o){f(s);var i=d.extend({},s,{currency:p(s.currency)});if(m){var h=d.extend({},o);if(v(h),h=d.extend({},t,h),r.areContextsEqual(i,m._context)&&r.areConfigurationsEqual(h,e))return m;throw new n}return d.extend(e,t,o),m=new c(i),a.asos.customer._savedItemsSdkInstance=m,u.trigger("savedItemsSdk:instanceReady"),u.savedItemsSdkInstantiated=!0,m}},a.asos.customer.savedItemsSdk});